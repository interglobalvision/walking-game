{"version":3,"sources":["index.min.js"],"names":["app","initialize","this","bindEvents","document","addEventListener","onDeviceReady","onContentLoaded","onBackKeyDown","receivedEvent","FastClick","attach","body","id","console","log","$","html","Game","getUsername","getPoints","getGems","getProgressPercent","Compass","stepSize","$blackout","$radar","$angle","$mapStage","$compass","$mapFloor","$compassContainer","$mapGoal","$mapSky","$mapGoalContainer","$mapOrientation","watchId","orientation","position","origin","lat","lng","destiny","modifiedDistance","minDistance","maxDistance","destinyThresholdRadius","totalDistance","getDistanceInKm","pointA","pointB","_this","R","dLat","deg2rad","dLon","a","Math","sin","cos","c","atan2","sqrt","d","rad2deg","rad","deg","PI","getRandomDistance","min","max","way","random","distance","getAngle","pointC","AB","pow","BC","AC","acos","updatePosition","reference","distanceToDestiny","distanceFromGoal","progressToGoal","mapFloorPos","mapGoalScale","css","-webkit-transform","transform","setStepsPot","distanceToSteps","stop","floor","updateOrientation","northOrientation","compensationAngle","angle","goalAngle","goalPos","scenePos","skyColor","now","Date","hour","getHours","mapTheme","addClass","getWorld","startGeoWatchers","navigator","geolocation","watchPosition","coords","latitude","longitude","error","alert","enableHighAccuracy","userAgent","match","compass","watchHeading","heading","magneticHeading","window","bind","event","alpha","stopGeoWatchers","clearWatch","unbind","nextMinigame","resetDestiny","callback","setNewPoints","Utilities","Number","getRandomInt","init","modifyDifficulty","DeviceOrientationEvent","getCurrentPosition","pos","parseInt","localStorage","getItem","animate","opacity","Dialog","read","Home","dialog","setItem","WalkingError","unsupportedGPS","unsupportedCompensation","throw","message","unsupported","tech","gameComplete","minigames","worlds","gameAttempts","shareTitle","score","shareSubject","shareUrl","createUser","username","newRank","setupLoop","currentLoops","getLoops","setProgress","setLoopOrder","Misc","shuffleArray","getProgress","progress","isNaN","currentProgress","length","setTotalDistance","newDistance","oldDistance","getTotalDistance","parseFloat","pot","getStepsPot","getTotalDistanceString","distances","randomDistance","calcDistance","toFixed","loops","setLoops","loopOrder","getLoopOrder","split","difficulty","modifier","gameOrder","Router","go","finishLoop","nextWorld","setRank","current","next","getWorldName","worldNum","Word","getAdj","getNoun","getRank","gameFail","tryAgainCallback","failCallback","points","setPoints","currentPoints","currentGems","modifiedPoints","round","resetPoints","gems","setGems","setNewGems","shareWithOptions","plugins","socialsharing","share","errorMessage","Menu","$menu","$menuButton","$menuPoints","$menuDistance","$menuRank","$menuWorld","$buttonShare","$buttonOpenSub","$buttonCloseSub","howtoGreeting","resetDestinyDialog","$resetDestiny","$devMenu","$devEnd","toggleMenu","closeSubMenu","toggle","prepend","on","preventDefault","openSubMenu","attr","menu","removeClass","regex","basePath","exec","location","href","cordova","platformId","isBrowser","url","Color","isNeighborColor","color1","color2","tolerance","undefined","abs","hslToRgb","h","s","l","r","g","b","hue2rgb","p","q","t","$target","$parent","$skip","interval","arrayIndex","lineIndex","lineTimer","outputText","inProgress","dialogArray","show","append","off","click.dialogRead","skipLine","finish","readLine","dialogLine","setInterval","innerHTML","clearLineInterval","clearInterval","hide","remove","array","temp","index","counter","vibrate","otherDuration","duration","roundFloat","number","adjs","nouns","adjsList","nounList","getWord","kind","indefinite","capitalize","list","word","charAt","toUpperCase","slice","isVowel","character","test","Adjs","Nouns"],"mappings":"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","file":"index.min.js","sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nvar app = {\n  // Application Constructor\n  initialize: function() {\n    this.bindEvents();\n  },\n\n  // Bind Event Listeners\n  //\n  // Bind any events that are required on startup. Common events are:\n  // 'load', 'deviceready', 'offline', and 'online'.\n  bindEvents: function() {\n    document.addEventListener('deviceready', this.onDeviceReady, false);\n    document.addEventListener('DOMContentLoaded', this.onContentLoaded, false);\n    document.addEventListener('backbutton', this.onBackKeyDown, false);\n  },\n\n  // deviceready Event Handler\n  //\n  // The scope of 'this' is the event. In order to call the 'receivedEvent'\n  // function, we must explicitly call 'app.receivedEvent(...);'\n  onDeviceReady: function() {\n    app.receivedEvent('deviceready');\n  },\n\n  onContentLoaded: function() {\n    FastClick.attach(document.body);\n  },\n\n  onBackKeyDown: function() {\n    return true;\n  },\n\n  // Update DOM on a Received Event\n  receivedEvent: function(id) {\n    console.log('Received Event: ' + id);\n\n    $('#game-username').html(Game.getUsername());\n    $('#game-points').html(Game.getPoints());\n    $('#game-gems').html(Game.getGems());\n    $('#game-progress').html(Game.getProgressPercent());\n  },\n};\n\napp.initialize();\nCompass = {\n  stepSize: 0.0008, // kilometers\n  $blackout: $('#blackout'),\n  $radar: $('#radar'),\n  $angle: $('#angle'),\n  $mapStage: $('.map-stage'),\n  $compass: $('#compass'),\n  $mapFloor: $('.map-floor'),\n  $compassContainer: $('#compass-container'),\n  $mapGoal: $('#map-goal'),\n  $mapSky: $('.map-sky'),\n  $mapGoalContainer: $('#map-goal-container'),\n  $mapOrientation: $('.map-orientation'),\n  watchId: {\n    orientation: null,\n    position: null,\n  },\n  origin: {\n    lat: null,\n    lng: null,\n  },\n  destiny: {\n    lat: null,\n    lng: null,\n  },\n  position: {\n    lat: null,\n    lng: null,\n  },\n  /*\n    minDistance: 0.0025, // in radians\n    maxDistance: 0.006, // in radians\n  */\n  modifiedDistance: 0,\n  minDistance: 0.0023, // in radians\n  maxDistance: 0.0026, // in radians\n  destinyThresholdRadius: 0.300, // in Km\n\n  totalDistance: 0,\n\n  /*\n   * Return distance between two geographical points in Kilometers\n   *\n   */\n  getDistanceInKm: function(pointA, pointB) {\n    var _this = this;\n\n    var R = 6371; // Radius of the earth in km\n    var dLat = _this.deg2rad(pointB.lat - pointA.lat);\n    var dLon = _this.deg2rad(pointB.lng - pointA.lng);\n    var a =\n      Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n      Math.cos(_this.deg2rad(pointA.lat)) * Math.cos(_this.deg2rad(pointB.lat)) *\n      Math.sin(dLon / 2) * Math.sin(dLon / 2)\n    ;\n    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    var d = R * c; // Distance in km\n\n    return d;\n  },\n\n  /*\n   * Convert radians to degrees\n   *\n   */\n  rad2deg: function(rad) {\n    return rad * 57.29577951308232;\n  },\n\n  /*\n   * Convert degrees to radians\n   *\n   */\n  deg2rad: function(deg) {\n    return deg * (Math.PI / 180);\n  },\n\n  /*\n   * Return a random number in the range of:\n   * -max < x <  -min\n   *  min < x < max\n   *\n   */\n  getRandomDistance: function(min, max) {\n    // Positive or negative?\n    var way = Math.random() >= 0.5;\n    var distance = Math.random() * (max - min) + min;\n\n    if (way) {\n      distance = distance * -1;\n    }\n\n    return distance;\n  },\n\n  /*\n   * Calculates the angle ABC (in radians)\n   *\n   * A first point\n   * C second point\n   * B center point\n   *\n   * It always return the smallest angle, so angle is always < 180deg\n   *\n   */\n  getAngle: function( pointA, pointB, pointC ) {\n    var _this = this;\n    var AB = Math.sqrt(Math.pow(pointB.lng - pointA.lng,2) + Math.pow(pointB.lat - pointA.lat,2));\n    var BC = Math.sqrt(Math.pow(pointB.lng - pointC.lng,2) + Math.pow(pointB.lat - pointC.lat,2));\n    var AC = Math.sqrt(Math.pow(pointC.lng - pointA.lng,2) + Math.pow(pointC.lat - pointA.lat,2));\n\n    return _this.rad2deg(Math.acos((BC * BC + AB * AB - AC * AC) / (2 * BC * AB)));\n  },\n\n  /*\n   * Update players geographical position\n   *\n   */\n  updatePosition: function(position) {\n    var _this = this;\n\n    // Update players position\n    _this.position = position;\n\n    // Update north reference\n    _this.reference = {\n      lat: position.lat + _this.minDistance,\n      lng: position.lng,\n    };\n\n    // Check distance in Km between position and destiny\n    var distanceToDestiny = _this.getDistanceInKm(_this.position, _this.destiny);\n\n    // distanceFromGoal is a percentage value describing how far you are from the destiny [meaning the threshold of destiny and the moment the next game triggers].\n    // This is based on your location from the moment the destiny is created.\n    // So at 100[%] you have just generated a new destiny. At 0[%] you are at destiny.\n    // This value can be larger than 100 if you move in the wrong direction.\n    var distanceFromGoal = ( (distanceToDestiny - _this.destinyThresholdRadius) * 100 ) / _this.totalDistance;\n\n    // progressToGoal is users progress toward goal radius.\n    // this is the inverse of distanceFromGoal\n    // 0[%] is moment of destiny creation and 100[%] is at destiny\n    var progressToGoal = 100 - distanceFromGoal;\n\n    // progressToGoal is multiplied to a thousandth decimal point of 75\n    // to use as pecentage of 75% when moving the map floor gradient.\n    // 75% is the full Y axis translation of the gradient\n    var mapFloorPos = progressToGoal * 0.75;\n\n    // progressToGoal is multiplied to a thousandth decimal point\n    // to use as scale of the map Goal object.\n    // 1.00 is the object at full scale (goal is reached).\n    var mapGoalScale = progressToGoal * 0.01;\n\n    // if mapFloorPos is less than 0, we set it to 0\n    // this keeps the floor from sliding off screen\n    if (mapFloorPos < 0) {\n      mapFloorPos = 0;\n    }\n\n    // if mapGoalScale is less than 0.01, we set it to 0.01\n    // goal object from disappearing entirely or going negative scale\n    if (mapGoalScale < 0.01) {\n      mapGoalScale = 0.01;\n    }\n\n    _this.$mapFloor.css({\n      '-webkit-transform': 'translateY(' + mapFloorPos + '%)',\n      'transform': 'translateY(' + mapFloorPos + '%)',\n    });\n\n    _this.$mapGoal.css({\n      '-webkit-transform': 'scale(' + mapGoalScale + ')',\n      'transform': 'scale(' + mapGoalScale + ')',\n    });\n\n    if (distanceToDestiny < _this.destinyThresholdRadius) {\n\n      //Game.setTotalDistance(distanceToDestiny); //add distance to total\n      Game.setStepsPot(_this.distanceToSteps(_this.totalDistance));\n\n      _this.stop();\n\n    }\n  },\n\n  distanceToSteps: function(distance) {\n    var _this = this;\n\n    return Math.floor(distance/_this.stepSize);\n  },\n\n  updateOrientation: function(orientation) {\n    var _this = this;\n\n    var northOrientation = orientation * -1;\n\n    // Get compensation angle\n    var compensationAngle = _this.getAngle( _this.reference, _this.position, _this.destiny);\n\n    // If destiny is at West of origin\n    if (_this.position.lng > _this.destiny.lng) {\n      compensationAngle = 360 - compensationAngle;\n    }\n\n    var angle = compensationAngle + northOrientation;\n\n    // All the following alculations are based on a\n    // the angle from 0 - 360, so we add 360 if the angle\n    // is negative.\n    if (angle < 0) {\n      angle = angle + 360;\n    }\n\n    // Here we save the angle in a new variable to use for\n    // the goal positioning.\n    var goalAngle = angle;\n\n    // We make that new angle from -180 - 180, because CSS\n    // translateX transform will need a pos or neg value\n    // to move the element left and right of center.\n    if (angle > 180) {\n      goalAngle = angle - 360;\n    }\n\n    // When the compass is pointed 70deg (+ or -) from 0 (top),\n    // the arrow points offscreen.  So we get a percent of 70\n    // to position the goal object with the arrow\n    var goalPos = goalAngle / 0.7;\n\n    // If the flag is offscreen, we don't move it\n    if (goalPos > 75) {\n      goalPos = 75;\n    } else if (goalPos < -75) {\n      goalPos = -75;\n    }\n\n    // for the scene we want a value from -25% - 25% to translate\n    // left or right of center.  180 / 25 = 7.2\n    var scenePos = angle / 7.2;\n\n    if (angle > 180) {\n      scenePos = ( ( angle - 180 ) / 7.2 ) - 25;\n    }\n\n    _this.$mapGoalContainer.css({\n      '-webkit-transform': 'translateX(' + goalPos + '%)',\n      'transform': 'translateX(' + goalPos + '%)',\n    });\n\n    _this.$mapOrientation.css({\n      '-webkit-transform': 'translateX(' + scenePos + '%)',\n      'transform': 'translateX(' + scenePos + '%)',\n    });\n\n    _this.$compass.css({\n      '-webkit-transform': 'rotate(' + angle + 'deg)',\n      'transform': 'rotate(' + angle + 'deg)',\n    });\n\n  },\n\n  skyColor: function() {\n    var _this = this;\n\n    var now = new Date();\n\n    if (now) {\n      var hour = now.getHours(),\n        skyColor;\n\n      if (hour > 4 && hour < 10) {\n\n        skyColor = 'rgb(100, 160, 255)'; // Morning 5 - 9\n\n      } else if (hour > 9 && hour < 17) {\n\n        skyColor = 'rgb(145, 205, 242)'; // Day 10 - 16\n\n      } else if (hour > 16 && hour < 22) {\n\n        skyColor = 'rgb(10, 40, 95)'; // Evening 17 - 21\n\n      } else {\n\n        skyColor = 'rgb(0, 20, 60)'; // Night 22 - 4\n\n      }\n\n      _this.$mapSky.css('background-color', skyColor); // set sky color\n    }\n  },\n\n  /*\n   * Sets map theme graphics\n   *\n   */\n  mapTheme: function() {\n    var _this = this;\n\n    _this.$mapStage.addClass('world-' + Game.getWorld());\n  },\n\n  /*\n   * Bind navigator.gelocation and deviceorientation events\n   *\n   */\n  startGeoWatchers: function () {\n    var _this = this;\n\n    // Start geolocation watch\n    _this.watchId.position = navigator.geolocation.watchPosition( function(position) {\n      _this.updatePosition({\n        lat: position.coords.latitude,\n        lng: position.coords.longitude,\n      });\n    }, function(error) {\n\n      alert(error);\n    }, {\n\n      enableHighAccuracy: true,\n    });\n\n    // Start orientation compass\n\n    // if cordova\n    if (navigator.userAgent.match(/(iPhone|iPod|Android)/)) {\n      _this.watchId.orientation = navigator.compass.watchHeading( function(heading) {\n        _this.updateOrientation(heading.magneticHeading);\n      });\n\n    } else {\n      $(window).bind('deviceorientation.compassOrientation', function() {\n        // dont parse event as function variable as breaks scope\n        _this.updateOrientation(event.alpha);\n     });\n    }\n  },\n\n  /*\n   * Ubind navigator.gelocation and deviceorientation events\n   *\n   */\n  stopGeoWatchers: function() {\n    var _this = this;\n\n    navigator.geolocation.clearWatch( _this.watchId.position );\n    navigator.compass.clearWatch( _this.watchId.orientation );\n\n  },\n\n  stop: function() {\n    var _this = this;\n\n    _this.stopGeoWatchers();\n    $(window).unbind('.compassOrientation');\n\n    Game.nextMinigame();\n  },\n\n  resetDestiny: function(callback) {\n    var _this = this;\n\n    _this.stopGeoWatchers();\n    $(window).unbind('.compassOrientation');\n\n    Game.setNewPoints( Utilities.Number.getRandomInt(-100,0) );\n\n    _this.init();\n\n    if (callback) {\n      callback();\n    }\n\n  },\n\n  init: function() {\n    var _this = this;\n\n    _this.modifiedDistance = Game.modifyDifficulty(0.0001);\n\n    _this.minDistance = _this.minDistance + _this.modifiedDistance; // in radians\n    _this.maxDistance = _this.maxDistance + _this.modifiedDistance; // in radians\n\n    // Check for geolocation and orientation availability\n    if (navigator.geolocation && window.DeviceOrientationEvent) {\n\n      // Set initial positions: origin, destiny, position\n      navigator.geolocation.getCurrentPosition( function(position) {\n\n        var pos = position.coords;\n\n        // Set Origin location\n        _this.origin.lat = pos.latitude,\n        _this.origin.lng = pos.longitude,\n\n        // Generate random destiny\n        _this.destiny.lat = pos.latitude + _this.getRandomDistance(_this.minDistance,_this.maxDistance);\n        _this.destiny.lng = pos.longitude + _this.getRandomDistance(_this.minDistance,_this.maxDistance);\n\n        // Set total distance\n        _this.totalDistance = _this.getDistanceInKm({\n          lat: pos.latitude,\n          lng: pos.longitude,\n        }, _this.destiny) - _this.destinyThresholdRadius;\n\n        // Set current position\n        _this.updatePosition({\n          lat: pos.latitude,\n          lng: pos.longitude,\n        });\n\n        // Set sky color\n        _this.skyColor();\n\n        // Set map theme graphics\n        _this.mapTheme();\n\n        // Start orientation and position watchers\n        _this.startGeoWatchers();\n\n        if (parseInt(window.localStorage.getItem('firstwalk')) === 1) {\n          // Fade in map with dialog\n          _this.$blackout.animate({'opacity': 0,}, 1000, 'linear', function() {\n            Utilities.Dialog.read(Home.dialog, function() {\n              $('#coach-container').animate({'opacity': 0,}, 1000, 'linear');\n              window.localStorage.setItem('firstwalk', 0);\n            });\n          });\n        } else {\n          $('#coach-container').css('opacity',0);\n          // Fade in map\n          _this.$blackout.animate({'opacity': 0,}, 1000, 'linear');\n        }\n\n      });\n\n    } else {\n\n      WalkingError.unsupportedGPS();\n\n    }\n  },\n};\n\nWalkingError = {\n  unsupportedCompensation: 1000,\n\n  // most basic not sure if useful\n  throw: function(log, message) {\n    console.log(log);\n    alert(message);\n  },\n\n  // most likely usecase\n  unsupported: function(tech) {\n    var _this = this;\n\n    if (!tech) {\n      tech = 'the required technology';\n    }\n\n    console.log(tech + ' is unsupported on this device');\n\n    alert('Sorry ' + Game.getUsername() + ', but your device does not support ' + tech + '!! But I will give you a consolation prize... Here\\'s ' + _this.unsupportedCompensation + ' points. Now get outta here!');\n\n    Game.gameComplete(_this.unsupportedCompensation);\n  },\n\n  // perhaps this is only likely to happen if a user says no to GPS\n  unsupportedGPS: function() {\n\n    console.log('Fuck. No GPS');\n    alert('Sorry ' + Game.getUsername() + ', but your device does not support GPS or you have denied the app access to your location. You can\\'t go walking if I don\\'t know where you are. Open the Walking Game settings on your device and allow location access!!');\n\n  },\n};\nGame = {\n  minigames: [\n    'supertap',\n    'hardcoreloud',\n    'twisterfingers',\n    'favfood',\n    'math',\n    'tippyswitch',\n    'reset',\n    'shakyvibrate',\n    'worldtraveler',\n    'colorsnap',\n    '1percent',\n    'vibeystopper',\n    'jankenpon',\n    'medit8',\n  ],\n  worlds: [\n    'Desert',\n    'City',\n    'Arctic',\n    'Jungle',\n  ],\n  gameAttempts: 2,\n\n  shareTitle: function(score) {\n    return 'WOOAAAAHH! U HAVE AN AWESOME SCORe 0F ' + score + ' POIIINTSSS BRAAAHHH';\n  },\n\n  shareSubject: 'Subject: I did this on Walking Game. The most tiring phone game ever made',\n  shareUrl: 'http://interglobal.vision/',\n\n  // USER\n\n  createUser: function(username, callback) {\n    var _this = this;\n\n    window.localStorage.setItem('username', username);\n    window.localStorage.setItem('points', 0);\n    window.localStorage.setItem('gems', 0);\n    window.localStorage.setItem('progress', 0);\n    window.localStorage.setItem('distance', 0);\n    window.localStorage.setItem('loops', 0);\n    window.localStorage.setItem('world', 0);\n    window.localStorage.setItem('firstwalk', 1);\n    window.localStorage.setItem('rank', _this.newRank());\n    _this.setupLoop();\n\n    callback();\n  },\n\n  getUsername: function() {\n    return window.localStorage.getItem('username');\n  },\n\n  // GAME STATE\n\n  setupLoop: function() {\n    var _this = this;\n    var currentLoops = _this.getLoops();\n\n    _this.setProgress(0);\n\n    if (currentLoops !== 0) {\n      _this.setLoopOrder( Utilities.Misc.shuffleArray(_this.minigames) );\n    }\n\n  },\n\n  getProgress: function() {\n    var progress = parseInt(window.localStorage.getItem('progress'));\n\n    if (progress === null || isNaN(progress)) {\n      progress = 0;\n    }\n\n    return progress;\n  },\n\n  setProgress: function(progress) {\n    window.localStorage.setItem('progress', progress);\n  },\n\n  getProgressPercent: function() {\n    var _this = this;\n    var currentProgress = _this.getProgress();\n\n    return currentProgress / this.minigames.length;\n  },\n\n  setTotalDistance: function(newDistance) {\n    var _this = this;\n    var oldDistance = _this.getTotalDistance();\n    var newDistance = parseFloat(newDistance);\n\n    window.localStorage.setItem('distance', oldDistance + newDistance);\n  },\n\n  setStepsPot: function(pot) {\n    var _this = this;\n\n    window.localStorage.setItem('stepsPot', pot);\n  },\n\n  getStepsPot: function() {\n    return window.localStorage.getItem('stepsPot') ? parseFloat( window.localStorage.getItem('stepsPot') ) : 0;\n  },\n\n  getTotalDistance: function() {\n    return window.localStorage.getItem('distance') ? parseFloat( window.localStorage.getItem('distance') ) : 0;\n  },\n\n  getTotalDistanceString: function() {\n    var _this = this;\n    var totalDistance = _this.getTotalDistance();\n\n    var distances = [\n      [ 0.0046, 'anacondas', ],\n      [ 0.025, 'blue whales', ],\n      [ 0.828, 'Burj Khalifas', ],\n      [ 0.006, 'elephant trunks', ],\n      [ 0.00206, 'Ebenezer Places', ],\n      [ 385000.6, 'Lunar distances', ],\n      [ 40075.0, 'Earth circumferences', ],\n    ];\n\n    var randomDistance = distances[ Utilities.Number.getRandomInt(0, distances.length - 1) ];\n    var calcDistance = totalDistance / randomDistance[0];\n\n    if ( calcDistance > 1 ) {\n      calcDistance = calcDistance.toFixed(3);\n    }\n\n    return calcDistance + ' ' + randomDistance[1];\n  },\n\n  getLoops: function() {\n    var loops = parseInt(window.localStorage.getItem('loops'));\n\n    if (loops === null || isNaN(loops)) {\n      loops = 0;\n    }\n\n    return loops;\n  },\n\n  setLoops: function(loops) {\n    window.localStorage.setItem('loops', loops);\n  },\n\n  setLoopOrder: function(loopOrder) {\n    window.localStorage.setItem('loopOrder', loopOrder);\n  },\n\n  getLoopOrder: function() {\n    var loopOrder = window.localStorage.getItem('loopOrder');\n\n    if(!loopOrder) {\n      return [];\n    }\n\n    return loopOrder.split(',');\n  },\n\n  modifyDifficulty: function(difficulty) {\n    var _this = this;\n    var modifier = _this.getLoops();\n\n    return modifier * difficulty;\n  },\n\n  nextMinigame: function() {\n    var _this = this;\n    var currentProgress = _this.getProgress();\n    var gameOrder = _this.getLoopOrder();\n\n    console.log('Loading next minigame');\n    console.log('Current progress index', currentProgress);\n    console.log('Game to load', gameOrder[currentProgress]);\n\n    Router.go('/games/' + gameOrder[currentProgress] + '/');\n  },\n\n  finishLoop: function() {\n    var _this = this;\n    var currentLoops = _this.getLoops();\n\n    console.log('Finished loop');\n\n    // perhaps a lot more needs to happen here. This is probably where the narrative should happen. But this could be a different route just for animation. Would then need to if/else in gameComplete when checking if last game in loop\n\n    _this.setLoops(currentLoops + 1);\n\n    _this.nextWorld();\n    _this.setRank();\n\n    console.log('Loops so far', currentLoops);\n\n    _this.setupLoop();\n\n    Router.go('/scenes/levelup/');\n  },\n\n  // WORLD\n\n  nextWorld: function() {\n    var _this = this;\n    var current = _this.getWorld();\n    var next = current + 1;\n\n    if ( next === _this.worlds.length ) {\n      window.localStorage.setItem('world', 0);\n    } else {\n      window.localStorage.setItem('world', next);\n    }\n  },\n\n  getWorld: function() {\n    return parseInt( window.localStorage.getItem('world') );\n  },\n\n  getWorldName: function() {\n    var _this = this;\n    var worldNum = _this.getWorld();\n\n    return _this.worlds[worldNum];\n  },\n\n  // RANK\n  setRank: function() {\n    var _this = this;\n\n    window.localStorage.setItem('rank', _this.newRank());\n  },\n\n  newRank: function() {\n    return Utilities.Word.getAdj(true, true) + ' ' + Utilities.Word.getNoun(false, true);\n  },\n\n  getRank: function() {\n    return window.localStorage.getItem('rank');\n  },\n\n  // MINI GAME\n\n  gameFail: function(tryAgainCallback, failCallback) {\n    var _this = this;\n\n    if (_this.gameAttempts > 1) {\n      _this.gameAttempts--;\n      tryAgainCallback();\n    } else {\n      failCallback();\n    }\n\n  },\n\n  gameComplete: function(points) {\n    var _this = this;\n    var currentProgress = _this.getProgress();\n\n    _this.setProgress(currentProgress + 1);\n\n    if (points) {\n      _this.setNewPoints(points);\n    }\n\n    if ((currentProgress + 1) === _this.minigames.length) {\n      _this.finishLoop();\n    } else {\n      Router.go('/pages/compass/');\n    }\n\n  },\n\n  // POINTS\n\n  getPoints: function() {\n    var points = parseInt( window.localStorage.getItem('points') );\n\n    if (points === null || isNaN(points)) {\n      points = 0;\n    }\n\n    return points;\n  },\n\n  setPoints: function(points) {\n    window.localStorage.setItem('points', points);\n  },\n\n  setNewPoints: function(points) {\n    var _this = this;\n\n    var points = parseInt(points);\n    var currentPoints = _this.getPoints();\n    var currentGems = _this.getGems();\n\n    if (points > 0) {\n      var modifier = (Math.log(currentGems + 1) + 1);\n      var modifiedPoints = Math.round((points * modifier));\n\n      _this.setPoints( currentPoints + modifiedPoints );\n    } else {\n      _this.setPoints( currentPoints + points );\n    }\n  },\n\n  resetPoints: function() {\n    var _this = this;\n\n    _this.setPoints(0);\n  },\n\n  // GEMS\n\n  getGems: function() {\n    var gems = parseInt( window.localStorage.getItem('gems') );\n\n    if (gems === null || isNaN(gems)) {\n      gems = 0;\n    }\n\n    return gems;\n  },\n\n  setGems: function(gems) {\n    window.localStorage.setItem('gems', gems);\n  },\n\n  setNewGems: function(gems) {\n    var _this = this;\n    var gems = parseInt(gems);\n    var currentGems = _this.getGems();\n\n    _this.setGems( currentGems + gems);\n  },\n\n  // SOCIAL SHARING\n\n  shareWithOptions: function() {\n    var _this = this;\n    var score = _this.getPoints();\n\n    window.plugins.socialsharing.share(\n      _this.shareTitle(score),\n      _this.shareSubject,\n      'http://puu.sh/mTFtM/242a0fa967.png',\n      _this.shareUrl,\n      function() {\n        console.log('share ok');\n      },\n\n      function(errorMessage) {\n        console.log('share failed');\n        console.log(errorMessage);\n        alert('something went wrong');\n      }\n\n    );\n\n  },\n\n};\n\nMenu = {\n  $blackout: $('#blackout'),\n  $menu: $('.menu'),\n  $menuButton: $('#map-menu-button'),\n  $menuPoints: $('#menu-points'),\n  $menuDistance: $('#menu-distance'),\n  $menuRank: $('#menu-rank'),\n  $menuWorld: $('#menu-world'),\n  $buttonShare: $('[data-ref=\"menu-share\"]'),\n  $buttonOpenSub: $('.open-sub-menu'),\n  $buttonCloseSub: $('.close-sub-menu'),\n\n  howtoGreeting: '<p>dear ' + Game.getUsername() + ',</p>',\n\n  resetDestinyDialog: [\n    'What? You lost? Pshh...',\n    'Ok, I\\'ll set a new walking goal for you, ' + Game.getUsername() + '...',\n    '...and imma take some points off your score!',\n  ],\n\n  $resetDestiny: $('[data-ref=\"menu-reset-destiny\"]'),\n\n  // Dev controls\n  $devMenu: $('[data-ref=\"dev-menu\"]'),\n  $devEnd: $('[data-ref=\"dev-end-map\"]'),\n\n  toggleMenu: function() {\n    var _this = this;\n\n    _this.closeSubMenu();\n\n    _this.$menu.toggle(\"fast\");\n  },\n\n  init: function() {\n    var _this = this;\n\n    _this.$menuPoints.html( Game.getPoints() );\n    _this.$menuDistance.html( Game.getTotalDistanceString() );\n    _this.$menuWorld.html( Game.getWorldName() );\n    _this.$menuRank.html( Game.getRank() );\n\n    $('.howto-text').prepend( _this.howtoGreeting );\n\n    // Toggle menu\n    _this.$menuButton.on('click', function() {\n      _this.toggleMenu();\n    });\n\n    // Share\n    _this.$buttonShare.on('click', function(event) {\n      event.preventDefault();\n      Game.shareWithOptions();\n    });\n\n    // Open sub menu\n    _this.$buttonOpenSub.on('click', function(event) {\n      event.preventDefault();\n      _this.openSubMenu( $(this).attr('data-ref') );\n    });\n\n    // Close sub menu\n    _this.$buttonCloseSub.on('click', function(event) {\n      event.preventDefault();\n      _this.closeSubMenu();\n    });\n\n    // Reset destiny\n    _this.$resetDestiny.on('click', function(event) {\n      event.preventDefault();\n      _this.toggleMenu();\n      Utilities.Dialog.read(_this.resetDestinyDialog, function() {\n        Compass.resetDestiny(function() {\n          _this.$menuPoints.html(Game.getPoints());\n        });\n      });\n    });\n\n    // Dev control click events\n    _this.$devMenu.on('click', function(event) {\n      event.preventDefault();\n      Router.go('/pages/dev/');\n    });\n\n    _this.$devEnd.on('click', function(event) {\n      event.preventDefault();\n      Compass.stop();\n    });\n\n  },\n\n  openSubMenu: function(menu) {\n    $('#menu-main').addClass('show-sub-menu');\n    $('#' + menu).addClass('show-sub-menu');\n  },\n\n  closeSubMenu: function() {\n    $('#menu-main').removeClass('show-sub-menu');\n    $('.sub-menu').removeClass('show-sub-menu');\n  },\n\n};\n\nRouter = {\n  init: function() {\n    var _this = this;\n    var regex = /(.+?(?:www))/;\n\n    _this.basePath = regex.exec(window.location.href);\n\n    if (window.cordova.platformId === 'browser') {\n      _this.isBrowser = true;\n    } else {\n      _this.isBrowser = false;\n    }\n  },\n\n  go: function(url) {\n    var _this = this;\n\n    if (_this.isBrowser) {\n      window.location = url;\n    } else {\n      window.location = _this.basePath[0] + url + 'index.html';\n    }\n  },\n};\n\nRouter.init();\nUtilities = {\n\n};\nUtilities.Color = {\n  isNeighborColor: function(color1, color2, tolerance) {\n    if (tolerance == undefined) {\n      tolerance = 32;\n    }\n\n    return Math.abs(color1[0] - color2[0]) <= tolerance && Math.abs(color1[1] - color2[1]) <= tolerance && Math.abs(color1[2] - color2[2]) <= tolerance;\n  },\n\n  hslToRgb: function(h, s, l){\n    var r, g, b;\n\n    if (s == 0) {\n        r = g = b = l; // achromatic\n    } else {\n      var hue2rgb = function hue2rgb(p, q, t){\n        if (t < 0) {\n          t += 1;\n        }\n\n        if (t > 1) {\n          t -= 1;\n        }\n\n        if (t < 1 / 6) {\n          return p + (q - p) * 6 * t;\n        }\n\n        if (t < 1 / 2) {\n          return q;\n        }\n\n        if (t < 2 / 3) {\n          return p + (q - p) * (2 / 3 - t) * 6;\n        }\n\n        return p;\n      };\n\n      var q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n      var p = 2 * l - q;\n\n      r = hue2rgb(p, q, h + 1 / 3);\n      g = hue2rgb(p, q, h);\n      b = hue2rgb(p, q, h - 1 / 3);\n    }\n\n    return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255),];\n  },\n};\nUtilities.Dialog = {\n  $target: $('.text-box-dialog'),\n  $parent: $('#dialog'),\n  $skip: undefined,\n  interval: 33,\n\n  arrayIndex: 0,\n\n  lineIndex: 0,\n  lineTimer: 0,\n  outputText: '',\n  inProgress: false,\n\n  read: function(dialogArray, callback) {\n\n    var _this = this;\n\n    _this.$parent = $('#dialog');\n    _this.$target = $('.text-box-dialog');\n\n    _this.dialogArray = dialogArray;\n    _this.arrayIndex = 0;\n\n    _this.$parent.show();\n    _this.inProgress = true;\n\n    _this.$parent.append('<div id=\"dialog-skip\"></div>');\n    _this.$skip = $('#dialog-skip');\n\n    _this.$skip.off('click.dialogRead').on({\n      'click.dialogRead': function() {\n        if (_this.lineTimer > 0) {\n          _this.skipLine();\n        } else {\n          if (_this.arrayIndex === (_this.dialogArray.length - 1)) {\n            _this.finish(callback);\n          } else {\n            _this.arrayIndex++;\n            _this.readLine();\n          }\n        }\n      },\n    });\n\n    _this.readLine();\n\n  },\n\n  readLine: function() {\n    var _this = this;\n    var dialogLine = _this.dialogArray[_this.arrayIndex];\n\n    _this.lineIndex = 0;\n    _this.$target.html('');\n    _this.outputText = '';\n\n    _this.lineTimer = setInterval(function() {\n\n      if (_this.lineIndex < dialogLine.length) {\n\n        _this.outputText += dialogLine[_this.lineIndex];\n        _this.$target[0].innerHTML = _this.outputText;\n\n        _this.lineIndex++;\n\n      } else {\n\n        _this.clearLineInterval();\n        _this.$target.append('<a class=\"text-box-next\">&rarr;</a>');\n\n      }\n\n    }, _this.interval);\n  },\n\n  clearLineInterval: function() {\n    var _this = this;\n\n    clearInterval(_this.lineTimer);\n    _this.lineTimer = 0;\n  },\n\n  skipLine: function() {\n    var _this = this;\n\n    _this.clearLineInterval();\n    _this.$target.html(_this.dialogArray[_this.arrayIndex]);\n    _this.$target.append('<a class=\"text-box-next\">&rarr;</a>');\n\n  },\n\n  finish: function(callback) {\n    var _this = this;\n\n    _this.$parent.hide();\n    _this.inProgress = false;\n    _this.$target.html('');\n    _this.$skip.remove();\n\n    if (callback) {\n      callback();\n    }\n  },\n\n};\n\nUtilities.Misc = {\n  shuffleArray: function(array) {\n    var counter = array.length, temp, index;\n\n    // While there are elements in the array\n    while (counter > 0) {\n      // Pick a random index\n      index = Math.floor(Math.random() * counter);\n\n      // Decrease counter by 1\n      counter--;\n\n      // And swap the last element with it\n      temp = array[counter];\n      array[counter] = array[index];\n      array[index] = temp;\n    }\n\n    return array;\n  },\n\n  vibrate: function(otherDuration) {\n    var duration = 1000;\n\n    if (otherDuration) {\n      duration = otherDuration;\n    }\n\n    if (navigator.vibrate) {\n      navigator.vibrate(duration);\n    } else {\n      console.log('no vibrate support');\n    }\n  },\n};\nUtilities.Number = {\n  getRandomInt: function(min, max) {\n    return Math.floor(Math.random() * (max - min + 1)) + min;\n  },\n  \n  roundFloat: function(number) {\n    // this is how to round to 3 decimal places in js lmao\n    number = (number + 0.00001) * 1000;\n    number = Math.floor(number);\n    number = number / 1000;\n\n    return number;\n  },\n};\nUtilities.Word = {\n  adjs: [],\n  nouns: [],\n\n  init: function(adjsList, nounList) {\n    var _this = this;\n\n    _this.adjs = adjsList;\n    _this.nouns = nounList;\n\n  },\n\n  /**\n   * Returns a word from the lists\n   * @param {string} kind Defines what kind of word return (adj|noun)\n   * @param {bool} indefinite Defines if it should append an indefinite article\n   */\n  getWord: function(kind, indefinite, capitalize) {\n    var _this = this;\n\n    var list = kind == 'adj' ? _this.adjs : _this.nouns;\n    var word = list[Math.floor(Math.random() * list.length)];\n\n    if (capitalize) {\n      word = word.charAt(0).toUpperCase() + word.slice(1);\n    }\n\n    if (indefinite) {\n      if (_this.isVowel(word[0])) {\n        word = 'an ' + word;\n      } else {\n        word = 'a ' + word;\n      }\n    }\n\n    return word;\n  },\n\n  getAdj: function(indefinite, capitalize) {\n    var _this = this;\n\n    return _this.getWord('adj', indefinite, capitalize);\n  },\n\n  getNoun: function(indefinite, capitalize) {\n    var _this = this;\n\n    return _this.getWord('noun', indefinite, capitalize);\n  },\n\n  isVowel: function(character) {\n    return /[aeiouAEIOU]/.test(character);\n  },\n};\n\nUtilities.Word.init(Adjs, Nouns);\n"]}